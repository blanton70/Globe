<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Globe with Layer Switching</title>
  <style>
    html, body {
      margin: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
      font-family: sans-serif;
    }
    #globeViz {
      height: 100%;
      width: 100%;
    }
    #controls {
      position: absolute;
      top: 10px;
      left: 10px;
      z-index: 10;
      background: rgba(255,255,255,0.9);
      padding: 10px;
      border-radius: 6px;
    }
  </style>
</head>
<body>
  <div id="globeViz"></div>
  <div id="controls">
    <label><input type="radio" name="layer" value="satellite" checked> Satellite</label><br>
    <label><input type="radio" name="layer" value="political"> Political</label><br>
    <label><input type="radio" name="layer" value="topo"> Topographic</label><br>
    <label><input type="radio" name="layer" value="ecoregions"> Ecoregions</label>
    <hr/>
<input type="text" id="speciesInput" placeholder="Enter species name (e.g. Panthera leo)">
<button id="searchBtn">Search</button>

  </div>

  <!-- Load Globe.gl and Three.js -->
  <script src="https://unpkg.com/three"></script>
  <script src="https://unpkg.com/globe.gl"></script>

  <script>
    const textureURLs = {
      satellite: 'https://unpkg.com/three-globe/example/img/earth-blue-marble.jpg',
      political: 'https://upload.wikimedia.org/wikipedia/commons/4/41/Political_World_Map_2021.png',
      topo: 'https://eoimages.gsfc.nasa.gov/images/imagerecords/74000/74192/world.topo.bathy.200412.3x5400x2700.jpg',
      ecoregions: 'https://storage.googleapis.com/eco-globe-maps/ecoregions.jpg' // Example custom
    };

    const Globe = window.Globe;
    const globe = Globe()(document.getElementById('globeViz'))
        .pointsData([])  // start empty
        .pointAltitude(0.01)
         .pointColor('color')
        .pointRadius('size')
      .globeImageUrl(textureURLs.satellite)
      .backgroundImageUrl('https://unpkg.com/three-globe/example/img/night-sky.png');

    globe.controls().autoRotate = true;
    globe.controls().autoRotateSpeed = 0.3;

    document.querySelectorAll("input[name='layer']").forEach(input => {
      input.addEventListener("change", e => {
        const selected = e.target.value;
        globe.globeImageUrl(textureURLs[selected]);
      });
    });
    document.getElementById('searchBtn').addEventListener('click', async () => {
  const species = document.getElementById('speciesInput').value.trim();
  if (!species) return alert('Enter a species name');

  const encoded = encodeURIComponent(species);

  try {
    const res = await fetch(`https://api.gbif.org/v1/occurrence/search?scientificName=${encoded}&limit=500`);
    const data = await res.json();

    const points = data.results
      .filter(obs => obs.decimalLatitude && obs.decimalLongitude)
      .map(obs => ({
        lat: obs.decimalLatitude,
        lng: obs.decimalLongitude,
        size: 0.5,
        color: 'orange'
      }));

    globe.pointsData(points);
  } catch (err) {
    console.error(err);
    alert('Failed to load species data');
  }
});

  </script>
</body>
</html>
